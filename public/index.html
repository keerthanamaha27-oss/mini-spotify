<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Spotify Dashboard</title>
<style>
body { font-family: 'Segoe UI', sans-serif; margin:0; padding:20px; background: linear-gradient(135deg,#1db954,#191414); color:#fff; }
h1 { text-align:center; margin:20px 0; font-size:3rem; text-shadow:2px 2px 10px rgba(0,0,0,0.5);}
form { display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-bottom:30px; }
select,input[type="file"],button { padding:10px 15px; border-radius:50px; border:none; font-size:1rem; outline:none; }
button { background: linear-gradient(90deg,#1db954,#1ed760); color:#fff; font-weight:bold; cursor:pointer; box-shadow:0 0 10px #1db954,0 0 20px #1ed760; transition:.3s; }
button:hover { transform:scale(1.05); box-shadow:0 0 20px #1db954,0 0 30px #1ed760; }
h2 { text-align:center; margin-top:40px; font-size:2rem; text-shadow:1px 1px 5px rgba(0,0,0,0.3); }
ul { list-style:none; padding:0 20px; }
li { background: rgba(255,255,255,0.05); padding:15px; margin-bottom:15px; border-radius:20px; box-shadow:0 0 10px rgba(0,0,0,0.3); transition:.3s; }
li:hover { background: rgba(255,255,255,0.1); transform:scale(1.02); }
audio { width:100%; margin-top:10px; outline:none; border-radius:10px; }
@media(max-width:600px){ form { flex-direction:column; align-items:center; } }
.now-playing-bar { position:fixed; bottom:0; left:0; width:100%; background:#1db954; color:#fff; padding:10px; text-align:center; font-weight:bold; display:flex; justify-content:space-between; align-items:center; gap:10px; }
.now-playing-bar button { border-radius:50px; padding:5px 10px; font-weight:bold; box-shadow:0 0 10px #fff; cursor:pointer; }
.progress-container { flex:1; height:5px; background:rgba(255,255,255,0.3); border-radius:5px; cursor:pointer; position:relative; margin:0 10px; }
.progress { height:100%; background:#fff; width:0%; border-radius:5px; }
</style>
</head>
<body>

<h1>Mini Spotify</h1>

<form id="uploadForm">
  <select id="categorySelect">
    <option value="Tamil">Tamil</option>
    <option value="English">English</option>
  </select>
  <input type="file" id="fileInput" />
  <button type="submit">Upload Song</button>
</form>

<div id="playlists">
  <h2>Tamil Songs</h2>
  <ul id="tamilList"></ul>

  <h2>English Songs</h2>
  <ul id="englishList"></ul>
</div>

<div class="now-playing-bar" id="nowBar">
  <button id="prevBtn">⏮</button>
  <span id="nowText">No song playing</span>
  <div class="progress-container" id="progressContainer">
    <div class="progress" id="progress"></div>
  </div>
  <button id="playPauseBtn">▶️</button>
  <button id="nextBtn">⏭</button>
</div>

<script>
const uploadForm = document.getElementById('uploadForm');
const fileInput = document.getElementById('fileInput');
const categorySelect = document.getElementById('categorySelect');
const tamilList = document.getElementById('tamilList');
const englishList = document.getElementById('englishList');

const nowText = document.getElementById('nowText');
const playPauseBtn = document.getElementById('playPauseBtn');
const nextBtn = document.getElementById('nextBtn');
const prevBtn = document.getElementById('prevBtn');
const progress = document.getElementById('progress');
const progressContainer = document.getElementById('progressContainer');

let playlists = {};
let currentCategory = null;
let currentIndex = -1;
let currentAudio = null;
let isPlaying = false;

// Load songs
async function loadSongs() {
  const res = await fetch('/songs');
  playlists = await res.json();
  tamilList.innerHTML=''; englishList.innerHTML='';

  (playlists.Tamil||[]).forEach((s,i)=>addSong(s,tamilList,'Tamil',i));
  (playlists.English||[]).forEach((s,i)=>addSong(s,englishList,'English',i));
}

// Add song
function addSong(song,listEl,category,index){
  const li=document.createElement('li');
  li.innerHTML=`<strong>${song.name}</strong><br><audio src="${song.url}"></audio>`;
  li.querySelector('audio').addEventListener('play',()=>playSong(category,index));
  listEl.appendChild(li);
}

// Play song
function playSong(category,index){
  if(currentAudio) currentAudio.pause();
  currentCategory=category;
  currentIndex=index;
  currentAudio=new Audio(playlists[category][index].url);
  currentAudio.play();
  isPlaying=true;
  nowText.textContent='Now Playing: '+playlists[category][index].name;
  playPauseBtn.textContent='⏸';

  currentAudio.addEventListener('timeupdate',updateProgress);
  currentAudio.addEventListener('ended',playNext);
}

// Play/Pause
playPauseBtn.addEventListener('click',()=>{
  if(!currentAudio) return;
  if(isPlaying){currentAudio.pause(); isPlaying=false; playPauseBtn.textContent='▶️';}
  else{currentAudio.play(); isPlaying=true; playPauseBtn.textContent='⏸';}
});

// Next song
nextBtn.addEventListener('click',playNext);
prevBtn.addEventListener('click',playPrev);

function playNext(){
  if(currentCategory===null) return;
  const list=playlists[currentCategory];
  if(currentIndex+1<list.length) playSong(currentCategory,currentIndex+1);
}

function playPrev(){
  if(currentCategory===null) return;
  const list=playlists[currentCategory];
  if(currentIndex>0) playSong(currentCategory,currentIndex-1);
}

// Update progress bar
function updateProgress(){
  const {currentTime,duration}=currentAudio;
  const percent=(currentTime/duration)*100;
  progress.style.width=percent+'%';
}

// Seek
progressContainer.addEventListener('click',e=>{
  if(!currentAudio) return;
  const width=progressContainer.clientWidth;
  const clickX=e.offsetX;
  const duration=currentAudio.duration;
  currentAudio.currentTime=(clickX/width)*duration;
});

// Handle upload
uploadForm.addEventListener('submit',async e=>{
  e.preventDefault();
  const file=fileInput.files[0];
  const category=categorySelect.value;
  if(!file) return alert('Select a file!');

  const formData=new FormData();
  formData.append('file',file);
  formData.append('category',category);

  try{
    const res=await fetch('/upload',{method:'POST',body:formData});
    const data=await res.json();
    if(data.error) return alert('Upload failed: '+data.error);
    alert('Upload successful!');
    fileInput.value='';
    loadSongs();
  }catch(err){ alert('Upload failed: '+err.message); }
});

loadSongs();
</script>
</body>
</html>
